-- NTH HIGHEST SALARY

--------------------------------------------------------
--  DDL for Table EMP2
--------------------------------------------------------

  CREATE TABLE EMP2 
   (	EMP2NO NUMBER(4,0), 
	ENAME VARCHAR2(10 BYTE), 
	JOB VARCHAR2(9 BYTE), 
	MGR NUMBER(4,0), 
	HIREDATE DATE, 
	SAL NUMBER(7,2), 
	COMM NUMBER(7,2), 
	DEPTNO NUMBER(2,0)
   );
   
Insert into EMP2 (EMP2NO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO) values (7839,'KING','PRESIDENT',null,to_date('17-NOV-81','DD-MON-RR'),5000,null,10);
Insert into EMP2 (EMP2NO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO) values (7902,'FORD','ANALYST',7566,to_date('03-DEC-81','DD-MON-RR'),3000,null,20);
Insert into EMP2 (EMP2NO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO) values (7788,'SCOTT','ANALYST',7566,to_date('09-DEC-82','DD-MON-RR'),3000,null,20);
Insert into EMP2 (EMP2NO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO) values (7566,'JONES','MANAGER',7839,to_date('02-APR-81','DD-MON-RR'),2975,null,20);
Insert into EMP2 (EMP2NO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO) values (7698,'BLAKE','MANAGER',7839,to_date('01-MAY-81','DD-MON-RR'),2850,null,30);
Insert into EMP2 (EMP2NO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO) values (7782,'CLARK','MANAGER',7839,to_date('09-JUN-81','DD-MON-RR'),2450,null,10);
Insert into EMP2 (EMP2NO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO) values (7499,'ALLEN','SALESMAN',7698,to_date('20-FEB-81','DD-MON-RR'),1600,300,30);
Insert into EMP2 (EMP2NO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO) values (7844,'TURNER','SALESMAN',7698,to_date('08-SEP-81','DD-MON-RR'),1500,0,30);
Insert into EMP2 (EMP2NO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO) values (7934,'MILLER','CLERK',7782,to_date('23-JAN-82','DD-MON-RR'),1300,null,10);
Insert into EMP2 (EMP2NO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO) values (7521,'WARD','SALESMAN',7698,to_date('22-FEB-81','DD-MON-RR'),1250,500,30);
Insert into EMP2 (EMP2NO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO) values (7654,'MARTIN','SALESMAN',7698,to_date('28-SEP-81','DD-MON-RR'),1250,1400,30);
Insert into EMP2 (EMP2NO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO) values (7876,'ADAMS','CLERK',7788,to_date('12-JAN-83','DD-MON-RR'),1100,null,20);
Insert into EMP2 (EMP2NO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO) values (7900,'JAMES','CLERK',7698,to_date('03-DEC-81','DD-MON-RR'),950,null,30);
Insert into EMP2 (EMP2NO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO) values (7369,'SMITH','CLERK',7902,to_date('17-DEC-80','DD-MON-RR'),800,null,20);

----------------------------------------------------------------------------
SELECT EMP2NO,
  ENAME,
  JOB,
  MGR,
  HIREDATE,
  SAL,
  COMM,
  DEPTNO
FROM EMP2
ORDER BY SAL DESC;
----------------------------------------------------------------------------   

|EMP2N0	|ENAME	|JOB		|MGR	|HIREDATE	|SAL	|COMM	|DEPTNO	|
|-------|-------|-----------|-------|-----------|-------|-------|-------|
|7839	|KING	|PRESIDENT	|		|17-NOV-81	|5000	|		|10		|
|7902	|FORD	|ANALYST	|7566	|03-DEC-81	|3000	|		|20		|
|7788	|SCOTT	|ANALYST	|7566	|09-DEC-82	|3000	|		|20		|
|7566	|JONES	|MANAGER	|7839	|02-APR-81	|2975	|		|20		|
|7698	|BLAKE	|MANAGER	|7839	|01-MAY-81	|2850	|		|30		|
|7782	|CLARK	|MANAGER	|7839	|09-JUN-81	|2450	|		|10		|
|7499	|ALLEN	|SALESMAN	|7698	|20-FEB-81	|1600	|300	|30		|
|7844	|TURNER	|SALESMAN	|7698	|08-SEP-81	|1500	|0		|30		|
|7934	|MILLER	|CLERK		|7782	|23-JAN-82	|1300	|		|10		|
|7521	|WARD	|SALESMAN	|7698	|22-FEB-81	|1250	|500	|30		|
|7654	|MARTIN	|SALESMAN	|7698	|28-SEP-81	|1250	|1400	|30		|
|7876	|ADAMS	|CLERK		|7788	|12-JAN-83	|1100	|		|20		|
|7900	|JAMES	|CLERK		|7698	|03-DEC-81	|950	|		|30		|
|7369	|SMITH	|CLERK		|7902	|17-DEC-80	|800	|		|20		|
   
   
----------------------------------------------------------------------------
|EMP2N0	|ENAME	|JOB		|MGR	|HIREDATE	|SAL	|COMM	|DEPTNO	|
|-------|-------|-----------|-------|-----------|-------|-------|-------|
|7902	|FORD	|ANALYST	|7566	|03-DEC-81	|3000	|		|20		|
|7788	|SCOTT	|ANALYST	|7566	|09-DEC-82	|3000	|		|20		|

-- USING WITH AS


WITH DISSAL AS
  ( SELECT DISTINCT SAL FROM EMP2 E ORDER BY SAL DESC
  ) ,
  RNSAL AS
  ( SELECT SAL,ROWNUM RN FROM DISSAL
  )
SELECT E.* FROM EMP2 E, RNSAL R1 WHERE RN=2 AND E.SAL = R1.SAL;

-- USING DENSE RANK()

SELECT EMP2NO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO
FROM
  ( SELECT E.*,DENSE_RANK() OVER(ORDER BY SAL DESC) RNK FROM EMP2 E
  )
WHERE RNK=2;

-- USING SELF JOIN AND COUNT() 
SELECT * FROM EMP2 E1 WHERE 2 = (SELECT COUNT(DISTINCT SAL) FROM EMP2 E2 WHERE E1.SAL <= E2.SAL);



